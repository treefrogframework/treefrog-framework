
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><link rel="canonical" href="http://mongoc.org/libbson/current/mongoc_change_stream_t.html"/>
    <title>mongoc_change_stream_t &#8212; libmongoc 1.21.2</title>
    <link rel="stylesheet" href="_static/readable.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/readable.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="mongoc_client_watch()" href="mongoc_client_watch.html" />
    <link rel="prev" title="mongoc_bulk_operation_update_one_with_opts()" href="mongoc_bulk_operation_update_one_with_opts.html" />
   
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head><body>
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="mongoc_client_watch.html" title="mongoc_client_watch()"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="mongoc_bulk_operation_update_one_with_opts.html" title="mongoc_bulk_operation_update_one_with_opts()"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">libmongoc 1.21.2</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="api.html" accesskey="U">API Reference</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="mongoc-change-stream-t">
<h1>mongoc_change_stream_t<a class="headerlink" href="#mongoc-change-stream-t" title="Permalink to this headline">¶</a></h1>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;mongoc/mongoc.h&gt;</span><span class="cp"></span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_mongoc_change_stream_t</span> <span class="n">mongoc_change_stream_t</span><span class="p">;</span>
</pre></div>
</div>
<p><a class="symbol reference internal" href="#"><span class="doc">mongoc_change_stream_t</span></a> is a handle to a change stream. A collection
change stream can be obtained using <a class="symbol reference internal" href="mongoc_collection_watch.html"><span class="doc">mongoc_collection_watch()</span></a>.</p>
<p>It is recommended to use a <a class="symbol reference internal" href="#"><span class="doc">mongoc_change_stream_t</span></a> and its functions instead of a raw aggregation with a <code class="docutils literal notranslate"><span class="pre">$changeStream</span></code> stage. For more information see the <a class="reference external" href="http://dochub.mongodb.org/core/changestreams">MongoDB Manual Entry on Change Streams</a>.</p>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">example-collection-watch.c</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;mongoc/mongoc.h&gt;</span><span class="cp"></span>

<span class="kt">int</span>
<span class="nf">main</span> <span class="p">()</span>
<span class="p">{</span>
   <span class="n">bson_t</span> <span class="n">empty</span> <span class="o">=</span> <span class="n">BSON_INITIALIZER</span><span class="p">;</span>
   <span class="k">const</span> <span class="n">bson_t</span> <span class="o">*</span><span class="n">doc</span><span class="p">;</span>
   <span class="n">bson_t</span> <span class="o">*</span><span class="n">to_insert</span> <span class="o">=</span> <span class="n">BCON_NEW</span> <span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="n">BCON_INT32</span> <span class="p">(</span><span class="mi">1</span><span class="p">));</span>
   <span class="k">const</span> <span class="n">bson_t</span> <span class="o">*</span><span class="n">err_doc</span><span class="p">;</span>
   <span class="n">bson_error_t</span> <span class="n">error</span><span class="p">;</span>
   <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">uri_string</span><span class="p">;</span>
   <span class="n">mongoc_uri_t</span> <span class="o">*</span><span class="n">uri</span><span class="p">;</span>
   <span class="n">mongoc_client_t</span> <span class="o">*</span><span class="n">client</span><span class="p">;</span>
   <span class="n">mongoc_collection_t</span> <span class="o">*</span><span class="n">coll</span><span class="p">;</span>
   <span class="n">mongoc_change_stream_t</span> <span class="o">*</span><span class="n">stream</span><span class="p">;</span>
   <span class="n">mongoc_write_concern_t</span> <span class="o">*</span><span class="n">wc</span> <span class="o">=</span> <span class="n">mongoc_write_concern_new</span> <span class="p">();</span>
   <span class="n">bson_t</span> <span class="n">opts</span> <span class="o">=</span> <span class="n">BSON_INITIALIZER</span><span class="p">;</span>
   <span class="kt">bool</span> <span class="n">r</span><span class="p">;</span>

   <span class="n">mongoc_init</span> <span class="p">();</span>

   <span class="n">uri_string</span> <span class="o">=</span> <span class="s">&quot;mongodb://&quot;</span>
                <span class="s">&quot;localhost:27017,localhost:27018,localhost:&quot;</span>
                <span class="s">&quot;27019/db?replicaSet=rs0&quot;</span><span class="p">;</span>

   <span class="n">uri</span> <span class="o">=</span> <span class="n">mongoc_uri_new_with_error</span> <span class="p">(</span><span class="n">uri_string</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">uri</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span>
               <span class="s">&quot;failed to parse URI: %s</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot;error message:       %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
               <span class="n">uri_string</span><span class="p">,</span>
               <span class="n">error</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">EXIT_FAILURE</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="n">client</span> <span class="o">=</span> <span class="n">mongoc_client_new_from_uri</span> <span class="p">(</span><span class="n">uri</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">client</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">EXIT_FAILURE</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="n">coll</span> <span class="o">=</span> <span class="n">mongoc_client_get_collection</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="s">&quot;db&quot;</span><span class="p">,</span> <span class="s">&quot;coll&quot;</span><span class="p">);</span>
   <span class="n">stream</span> <span class="o">=</span> <span class="n">mongoc_collection_watch</span> <span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">empty</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

   <span class="n">mongoc_write_concern_set_wmajority</span> <span class="p">(</span><span class="n">wc</span><span class="p">,</span> <span class="mi">10000</span><span class="p">);</span>
   <span class="n">mongoc_write_concern_append</span> <span class="p">(</span><span class="n">wc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opts</span><span class="p">);</span>
   <span class="n">r</span> <span class="o">=</span> <span class="n">mongoc_collection_insert_one</span> <span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="n">to_insert</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opts</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;Error: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">EXIT_FAILURE</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">while</span> <span class="p">(</span><span class="n">mongoc_change_stream_next</span> <span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">doc</span><span class="p">))</span> <span class="p">{</span>
      <span class="kt">char</span> <span class="o">*</span><span class="n">as_json</span> <span class="o">=</span> <span class="n">bson_as_relaxed_extended_json</span> <span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
      <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;Got document: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">as_json</span><span class="p">);</span>
      <span class="n">bson_free</span> <span class="p">(</span><span class="n">as_json</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">mongoc_change_stream_error_document</span> <span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">err_doc</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">bson_empty</span> <span class="p">(</span><span class="n">err_doc</span><span class="p">))</span> <span class="p">{</span>
         <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span>
                  <span class="s">&quot;Server Error: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                  <span class="n">bson_as_relaxed_extended_json</span> <span class="p">(</span><span class="n">err_doc</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">));</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;Client Error: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">EXIT_FAILURE</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="n">bson_destroy</span> <span class="p">(</span><span class="n">to_insert</span><span class="p">);</span>
   <span class="n">mongoc_write_concern_destroy</span> <span class="p">(</span><span class="n">wc</span><span class="p">);</span>
   <span class="n">bson_destroy</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">opts</span><span class="p">);</span>
   <span class="n">mongoc_change_stream_destroy</span> <span class="p">(</span><span class="n">stream</span><span class="p">);</span>
   <span class="n">mongoc_collection_destroy</span> <span class="p">(</span><span class="n">coll</span><span class="p">);</span>
   <span class="n">mongoc_uri_destroy</span> <span class="p">(</span><span class="n">uri</span><span class="p">);</span>
   <span class="n">mongoc_client_destroy</span> <span class="p">(</span><span class="n">client</span><span class="p">);</span>
   <span class="n">mongoc_cleanup</span> <span class="p">();</span>

   <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="starting-and-resuming">
<h3>Starting and Resuming<a class="headerlink" href="#starting-and-resuming" title="Permalink to this headline">¶</a></h3>
<p>All <code class="docutils literal notranslate"><span class="pre">watch</span></code> functions accept several options to indicate where a change stream should start returning changes from: <code class="docutils literal notranslate"><span class="pre">resumeAfter</span></code>, <code class="docutils literal notranslate"><span class="pre">startAfter</span></code>, and <code class="docutils literal notranslate"><span class="pre">startAtOperationTime</span></code>.</p>
<p>All changes returned by <a class="symbol reference internal" href="mongoc_change_stream_next.html"><span class="doc">mongoc_change_stream_next()</span></a> include a resume token in the <code class="docutils literal notranslate"><span class="pre">_id</span></code> field. MongoDB 4.2 also includes an additional resume token in each “aggregate” and “getMore” command response, which points to the end of that response’s batch. The current token is automatically cached by libmongoc. In the event of an error, libmongoc attempts to recreate the change stream starting where it left off by passing the cached resume token. libmongoc only attempts to resume once, but client applications can access the cached resume token with <a class="symbol reference internal" href="mongoc_change_stream_get_resume_token.html"><span class="doc">mongoc_change_stream_get_resume_token()</span></a> and use it for their own resume logic by passing it as either the <code class="docutils literal notranslate"><span class="pre">resumeAfter</span></code> or <code class="docutils literal notranslate"><span class="pre">startAfter</span></code> option.</p>
<p>Additionally, change streams can start returning changes at an operation time by using the <code class="docutils literal notranslate"><span class="pre">startAtOperationTime</span></code> field. This can be the timestamp returned in the <code class="docutils literal notranslate"><span class="pre">operationTime</span></code> field of a command reply.</p>
<p><code class="docutils literal notranslate"><span class="pre">resumeAfter</span></code>, <code class="docutils literal notranslate"><span class="pre">startAfter</span></code>, and <code class="docutils literal notranslate"><span class="pre">startAtOperationTime</span></code> are mutually exclusive options. Setting more than one will result in a server error.</p>
<p>The following example implements custom resuming logic, persisting the resume token in a file.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">example-resume.c</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;mongoc/mongoc.h&gt;</span><span class="cp"></span>

<span class="cm">/* An example implementation of custom resume logic in a change stream.</span>
<span class="cm">* example-resume starts a client-wide change stream and persists the resume</span>
<span class="cm">* token in a file &quot;resume-token.json&quot;. On restart, if &quot;resume-token.json&quot;</span>
<span class="cm">* exists, the change stream starts watching after the persisted resume token.</span>
<span class="cm">*</span>
<span class="cm">* This behavior allows a user to exit example-resume, and restart it later</span>
<span class="cm">* without missing any change events.</span>
<span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">RESUME_TOKEN_PATH</span> <span class="o">=</span> <span class="s">&quot;resume-token.json&quot;</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">bool</span>
<span class="nf">_save_resume_token</span> <span class="p">(</span><span class="k">const</span> <span class="n">bson_t</span> <span class="o">*</span><span class="n">doc</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">FILE</span> <span class="o">*</span><span class="n">file_stream</span><span class="p">;</span>
   <span class="n">bson_iter_t</span> <span class="n">iter</span><span class="p">;</span>
   <span class="n">bson_t</span> <span class="n">resume_token_doc</span><span class="p">;</span>
   <span class="kt">char</span> <span class="o">*</span><span class="n">as_json</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
   <span class="kt">size_t</span> <span class="n">as_json_len</span><span class="p">;</span>
   <span class="kt">ssize_t</span> <span class="n">r</span><span class="p">,</span> <span class="n">n_written</span><span class="p">;</span>
   <span class="k">const</span> <span class="n">bson_value_t</span> <span class="o">*</span><span class="n">resume_token</span><span class="p">;</span>

   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">bson_iter_init_find</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="s">&quot;_id&quot;</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;reply does not contain operationTime.&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="n">resume_token</span> <span class="o">=</span> <span class="n">bson_iter_value</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>
   <span class="cm">/* store the resume token in a document, { resumeAfter: &lt;resume token&gt; }</span>
<span class="cm">    * which we can later append easily. */</span>
   <span class="n">file_stream</span> <span class="o">=</span> <span class="n">fopen</span> <span class="p">(</span><span class="n">RESUME_TOKEN_PATH</span><span class="p">,</span> <span class="s">&quot;w+&quot;</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">file_stream</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;failed to open %s for writing</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">RESUME_TOKEN_PATH</span><span class="p">);</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="n">bson_init</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">resume_token_doc</span><span class="p">);</span>
   <span class="n">BSON_APPEND_VALUE</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">resume_token_doc</span><span class="p">,</span> <span class="s">&quot;resumeAfter&quot;</span><span class="p">,</span> <span class="n">resume_token</span><span class="p">);</span>
   <span class="n">as_json</span> <span class="o">=</span> <span class="n">bson_as_canonical_extended_json</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">resume_token_doc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">as_json_len</span><span class="p">);</span>
   <span class="n">bson_destroy</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">resume_token_doc</span><span class="p">);</span>
   <span class="n">n_written</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="k">while</span> <span class="p">(</span><span class="n">n_written</span> <span class="o">&lt;</span> <span class="n">as_json_len</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">r</span> <span class="o">=</span> <span class="n">fwrite</span> <span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">as_json</span> <span class="o">+</span> <span class="n">n_written</span><span class="p">),</span>
                  <span class="k">sizeof</span> <span class="p">(</span><span class="kt">char</span><span class="p">),</span>
                  <span class="n">as_json_len</span> <span class="o">-</span> <span class="n">n_written</span><span class="p">,</span>
                  <span class="n">file_stream</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;failed to write to %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">RESUME_TOKEN_PATH</span><span class="p">);</span>
         <span class="n">bson_free</span> <span class="p">(</span><span class="n">as_json</span><span class="p">);</span>
         <span class="n">fclose</span> <span class="p">(</span><span class="n">file_stream</span><span class="p">);</span>
         <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">n_written</span> <span class="o">+=</span> <span class="n">r</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="n">bson_free</span> <span class="p">(</span><span class="n">as_json</span><span class="p">);</span>
   <span class="n">fclose</span> <span class="p">(</span><span class="n">file_stream</span><span class="p">);</span>
   <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span>
<span class="nf">_load_resume_token</span> <span class="p">(</span><span class="n">bson_t</span> <span class="o">*</span><span class="n">opts</span><span class="p">)</span>
<span class="p">{</span>
   <span class="n">bson_error_t</span> <span class="n">error</span><span class="p">;</span>
   <span class="n">bson_json_reader_t</span> <span class="o">*</span><span class="n">reader</span><span class="p">;</span>
   <span class="n">bson_t</span> <span class="n">doc</span><span class="p">;</span>

   <span class="cm">/* if the file does not exist, skip. */</span>
   <span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">access</span> <span class="p">(</span><span class="n">RESUME_TOKEN_PATH</span><span class="p">,</span> <span class="n">R_OK</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="n">reader</span> <span class="o">=</span> <span class="n">bson_json_reader_new_from_file</span> <span class="p">(</span><span class="n">RESUME_TOKEN_PATH</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">reader</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span>
               <span class="s">&quot;failed to open %s for reading: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
               <span class="n">RESUME_TOKEN_PATH</span><span class="p">,</span>
               <span class="n">error</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="n">bson_init</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">doc</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">bson_json_reader_read</span> <span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">doc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;failed to read doc from %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">RESUME_TOKEN_PATH</span><span class="p">);</span>
      <span class="n">bson_destroy</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">doc</span><span class="p">);</span>
      <span class="n">bson_json_reader_destroy</span> <span class="p">(</span><span class="n">reader</span><span class="p">);</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;found cached resume token in %s, resuming change stream.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
           <span class="n">RESUME_TOKEN_PATH</span><span class="p">);</span>

   <span class="n">bson_concat</span> <span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">doc</span><span class="p">);</span>
   <span class="n">bson_destroy</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">doc</span><span class="p">);</span>
   <span class="n">bson_json_reader_destroy</span> <span class="p">(</span><span class="n">reader</span><span class="p">);</span>
   <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="nf">main</span> <span class="p">()</span>
<span class="p">{</span>
   <span class="kt">int</span> <span class="n">exit_code</span> <span class="o">=</span> <span class="n">EXIT_FAILURE</span><span class="p">;</span>
   <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">uri_string</span><span class="p">;</span>
   <span class="n">mongoc_uri_t</span> <span class="o">*</span><span class="n">uri</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
   <span class="n">bson_error_t</span> <span class="n">error</span><span class="p">;</span>
   <span class="n">mongoc_client_t</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
   <span class="n">bson_t</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="n">BSON_INITIALIZER</span><span class="p">;</span>
   <span class="n">bson_t</span> <span class="n">opts</span> <span class="o">=</span> <span class="n">BSON_INITIALIZER</span><span class="p">;</span>
   <span class="n">mongoc_change_stream_t</span> <span class="o">*</span><span class="n">stream</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
   <span class="k">const</span> <span class="n">bson_t</span> <span class="o">*</span><span class="n">doc</span><span class="p">;</span>

   <span class="k">const</span> <span class="kt">int</span> <span class="n">max_time</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span> <span class="cm">/* max amount of time, in seconds, that</span>
<span class="cm">                               mongoc_change_stream_next can block. */</span>

   <span class="n">mongoc_init</span> <span class="p">();</span>
   <span class="n">uri_string</span> <span class="o">=</span> <span class="s">&quot;mongodb://localhost:27017/db?replicaSet=rs0&quot;</span><span class="p">;</span>
   <span class="n">uri</span> <span class="o">=</span> <span class="n">mongoc_uri_new_with_error</span> <span class="p">(</span><span class="n">uri_string</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">uri</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span>
               <span class="s">&quot;failed to parse URI: %s</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot;error message:       %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
               <span class="n">uri_string</span><span class="p">,</span>
               <span class="n">error</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
      <span class="k">goto</span> <span class="n">cleanup</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="n">client</span> <span class="o">=</span> <span class="n">mongoc_client_new_from_uri</span> <span class="p">(</span><span class="n">uri</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">client</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">goto</span> <span class="n">cleanup</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_load_resume_token</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">opts</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">goto</span> <span class="n">cleanup</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="n">BSON_APPEND_INT64</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">opts</span><span class="p">,</span> <span class="s">&quot;maxAwaitTimeMS&quot;</span><span class="p">,</span> <span class="n">max_time</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>

   <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;listening for changes on the client (max %d seconds).</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">max_time</span><span class="p">);</span>
   <span class="n">stream</span> <span class="o">=</span> <span class="n">mongoc_client_watch</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pipeline</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opts</span><span class="p">);</span>

   <span class="k">while</span> <span class="p">(</span><span class="n">mongoc_change_stream_next</span> <span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">doc</span><span class="p">))</span> <span class="p">{</span>
      <span class="kt">char</span> <span class="o">*</span><span class="n">as_json</span><span class="p">;</span>

      <span class="n">as_json</span> <span class="o">=</span> <span class="n">bson_as_canonical_extended_json</span> <span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
      <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;change received: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">as_json</span><span class="p">);</span>
      <span class="n">bson_free</span> <span class="p">(</span><span class="n">as_json</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_save_resume_token</span> <span class="p">(</span><span class="n">doc</span><span class="p">))</span> <span class="p">{</span>
         <span class="k">goto</span> <span class="n">cleanup</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="n">exit_code</span> <span class="o">=</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>

<span class="nl">cleanup</span><span class="p">:</span>
   <span class="n">mongoc_uri_destroy</span> <span class="p">(</span><span class="n">uri</span><span class="p">);</span>
   <span class="n">bson_destroy</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">pipeline</span><span class="p">);</span>
   <span class="n">bson_destroy</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">opts</span><span class="p">);</span>
   <span class="n">mongoc_change_stream_destroy</span> <span class="p">(</span><span class="n">stream</span><span class="p">);</span>
   <span class="n">mongoc_client_destroy</span> <span class="p">(</span><span class="n">client</span><span class="p">);</span>
   <span class="n">mongoc_cleanup</span> <span class="p">();</span>
   <span class="k">return</span> <span class="n">exit_code</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>The following example shows using <code class="docutils literal notranslate"><span class="pre">startAtOperationTime</span></code> to synchronize a change stream with another operation.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">example-start-at-optime.c</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* An example of starting a change stream with startAtOperationTime. */</span>
<span class="cp">#include</span> <span class="cpf">&lt;mongoc/mongoc.h&gt;</span><span class="cp"></span>

<span class="kt">int</span>
<span class="nf">main</span> <span class="p">()</span>
<span class="p">{</span>
   <span class="kt">int</span> <span class="n">exit_code</span> <span class="o">=</span> <span class="n">EXIT_FAILURE</span><span class="p">;</span>
   <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">uri_string</span><span class="p">;</span>
   <span class="n">mongoc_uri_t</span> <span class="o">*</span><span class="n">uri</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
   <span class="n">bson_error_t</span> <span class="n">error</span><span class="p">;</span>
   <span class="n">mongoc_client_t</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
   <span class="n">mongoc_collection_t</span> <span class="o">*</span><span class="n">coll</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
   <span class="n">bson_t</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="n">BSON_INITIALIZER</span><span class="p">;</span>
   <span class="n">bson_t</span> <span class="n">opts</span> <span class="o">=</span> <span class="n">BSON_INITIALIZER</span><span class="p">;</span>
   <span class="n">mongoc_change_stream_t</span> <span class="o">*</span><span class="n">stream</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
   <span class="n">bson_iter_t</span> <span class="n">iter</span><span class="p">;</span>
   <span class="k">const</span> <span class="n">bson_t</span> <span class="o">*</span><span class="n">doc</span><span class="p">;</span>
   <span class="n">bson_value_t</span> <span class="n">cached_operation_time</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
   <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
   <span class="kt">bool</span> <span class="n">r</span><span class="p">;</span>

   <span class="n">mongoc_init</span> <span class="p">();</span>
   <span class="n">uri_string</span> <span class="o">=</span> <span class="s">&quot;mongodb://localhost:27017/db?replicaSet=rs0&quot;</span><span class="p">;</span>
   <span class="n">uri</span> <span class="o">=</span> <span class="n">mongoc_uri_new_with_error</span> <span class="p">(</span><span class="n">uri_string</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">uri</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span>
               <span class="s">&quot;failed to parse URI: %s</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot;error message:       %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
               <span class="n">uri_string</span><span class="p">,</span>
               <span class="n">error</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
      <span class="k">goto</span> <span class="n">cleanup</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="n">client</span> <span class="o">=</span> <span class="n">mongoc_client_new_from_uri</span> <span class="p">(</span><span class="n">uri</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">client</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">goto</span> <span class="n">cleanup</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="cm">/* insert five documents. */</span>
   <span class="n">coll</span> <span class="o">=</span> <span class="n">mongoc_client_get_collection</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="s">&quot;db&quot;</span><span class="p">,</span> <span class="s">&quot;coll&quot;</span><span class="p">);</span>
   <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">bson_t</span> <span class="n">reply</span><span class="p">;</span>
      <span class="n">bson_t</span> <span class="o">*</span><span class="n">insert_cmd</span> <span class="o">=</span> <span class="n">BCON_NEW</span> <span class="p">(</span><span class="s">&quot;insert&quot;</span><span class="p">,</span>
                                     <span class="s">&quot;coll&quot;</span><span class="p">,</span>
                                     <span class="s">&quot;documents&quot;</span><span class="p">,</span>
                                     <span class="s">&quot;[&quot;</span><span class="p">,</span>
                                     <span class="s">&quot;{&quot;</span><span class="p">,</span>
                                     <span class="s">&quot;x&quot;</span><span class="p">,</span>
                                     <span class="n">BCON_INT64</span> <span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                     <span class="s">&quot;}&quot;</span><span class="p">,</span>
                                     <span class="s">&quot;]&quot;</span><span class="p">);</span>

      <span class="n">r</span> <span class="o">=</span> <span class="n">mongoc_collection_write_command_with_opts</span> <span class="p">(</span>
         <span class="n">coll</span><span class="p">,</span> <span class="n">insert_cmd</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reply</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">);</span>
      <span class="n">bson_destroy</span> <span class="p">(</span><span class="n">insert_cmd</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">bson_destroy</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">reply</span><span class="p">);</span>
         <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;failed to insert: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
         <span class="k">goto</span> <span class="n">cleanup</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
         <span class="cm">/* cache the operation time in the first reply. */</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">bson_iter_init_find</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reply</span><span class="p">,</span> <span class="s">&quot;operationTime&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">bson_value_copy</span> <span class="p">(</span><span class="n">bson_iter_value</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">iter</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">cached_operation_time</span><span class="p">);</span>
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;reply does not contain operationTime.&quot;</span><span class="p">);</span>
            <span class="n">bson_destroy</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">reply</span><span class="p">);</span>
            <span class="k">goto</span> <span class="n">cleanup</span><span class="p">;</span>
         <span class="p">}</span>
      <span class="p">}</span>
      <span class="n">bson_destroy</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">reply</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="cm">/* start a change stream at the first returned operationTime. */</span>
   <span class="n">BSON_APPEND_VALUE</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">opts</span><span class="p">,</span> <span class="s">&quot;startAtOperationTime&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cached_operation_time</span><span class="p">);</span>
   <span class="n">stream</span> <span class="o">=</span> <span class="n">mongoc_collection_watch</span> <span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pipeline</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opts</span><span class="p">);</span>

   <span class="cm">/* since the change stream started at the operation time of the first</span>
<span class="cm">    * insert, the five inserts are returned. */</span>
   <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;listening for changes on db.coll:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
   <span class="k">while</span> <span class="p">(</span><span class="n">mongoc_change_stream_next</span> <span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">doc</span><span class="p">))</span> <span class="p">{</span>
      <span class="kt">char</span> <span class="o">*</span><span class="n">as_json</span><span class="p">;</span>

      <span class="n">as_json</span> <span class="o">=</span> <span class="n">bson_as_canonical_extended_json</span> <span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
      <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;change received: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">as_json</span><span class="p">);</span>
      <span class="n">bson_free</span> <span class="p">(</span><span class="n">as_json</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="n">exit_code</span> <span class="o">=</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>

<span class="nl">cleanup</span><span class="p">:</span>
   <span class="n">mongoc_uri_destroy</span> <span class="p">(</span><span class="n">uri</span><span class="p">);</span>
   <span class="n">bson_destroy</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">pipeline</span><span class="p">);</span>
   <span class="n">bson_destroy</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">opts</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">cached_operation_time</span><span class="p">.</span><span class="n">value_type</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">bson_value_destroy</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">cached_operation_time</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="n">mongoc_change_stream_destroy</span> <span class="p">(</span><span class="n">stream</span><span class="p">);</span>
   <span class="n">mongoc_collection_destroy</span> <span class="p">(</span><span class="n">coll</span><span class="p">);</span>
   <span class="n">mongoc_client_destroy</span> <span class="p">(</span><span class="n">client</span><span class="p">);</span>
   <span class="n">mongoc_cleanup</span> <span class="p">();</span>
   <span class="k">return</span> <span class="n">exit_code</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="mongoc_client_watch.html">mongoc_client_watch()</a></li>
<li class="toctree-l1"><a class="reference internal" href="mongoc_database_watch.html">mongoc_database_watch()</a></li>
<li class="toctree-l1"><a class="reference internal" href="mongoc_collection_watch.html">mongoc_collection_watch()</a></li>
<li class="toctree-l1"><a class="reference internal" href="mongoc_change_stream_next.html">mongoc_change_stream_next()</a></li>
<li class="toctree-l1"><a class="reference internal" href="mongoc_change_stream_get_resume_token.html">mongoc_change_stream_get_resume_token()</a></li>
<li class="toctree-l1"><a class="reference internal" href="mongoc_change_stream_error_document.html">mongoc_change_stream_error_document()</a></li>
<li class="toctree-l1"><a class="reference internal" href="mongoc_change_stream_destroy.html">mongoc_change_stream_destroy()</a></li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installing.html">Installing the MongoDB C Driver (libmongoc) and BSON library (libbson)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="authentication.html">Authentication</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basic-troubleshooting.html">Basic Troubleshooting</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="guides.html">Guides</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="api.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="init-cleanup.html">Initialization and cleanup</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="errors.html">Error Reporting</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifecycle.html">Object Lifecycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="gridfs.html">GridFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_auto_encryption_opts_t.html">mongoc_auto_encryption_opts_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_bulk_operation_t.html">mongoc_bulk_operation_t</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">mongoc_change_stream_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_client_encryption_t.html">mongoc_client_encryption_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_client_encryption_datakey_opts_t.html">mongoc_client_encryption_datakey_opts_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_client_encryption_encrypt_opts_t.html">mongoc_client_encryption_encrypt_opts_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_client_encryption_opts_t.html">mongoc_client_encryption_opts_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_client_pool_t.html">mongoc_client_pool_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_client_session_t.html">mongoc_client_session_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_client_session_with_transaction_cb_t.html">mongoc_client_session_with_transaction_cb_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_client_t.html">mongoc_client_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_collection_t.html">mongoc_collection_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_cursor_t.html">mongoc_cursor_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_database_t.html">mongoc_database_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_delete_flags_t.html">mongoc_delete_flags_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_find_and_modify_opts_t.html">mongoc_find_and_modify_opts_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_gridfs_file_list_t.html">mongoc_gridfs_file_list_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_gridfs_file_opt_t.html">mongoc_gridfs_file_opt_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_gridfs_file_t.html">mongoc_gridfs_file_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_gridfs_bucket_t.html">mongoc_gridfs_bucket_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_gridfs_t.html">mongoc_gridfs_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_host_list_t.html">mongoc_host_list_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_index_opt_geo_t.html">mongoc_index_opt_geo_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_index_opt_t.html">mongoc_index_opt_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_index_opt_wt_t.html">mongoc_index_opt_wt_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_insert_flags_t.html">mongoc_insert_flags_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_iovec_t.html">mongoc_iovec_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_matcher_t.html">mongoc_matcher_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_optional_t.html">mongoc_optional_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_query_flags_t.html">mongoc_query_flags_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_rand.html">mongoc_rand</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_read_concern_t.html">mongoc_read_concern_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_read_mode_t.html">mongoc_read_mode_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_read_prefs_t.html">mongoc_read_prefs_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_remove_flags_t.html">mongoc_remove_flags_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_reply_flags_t.html">mongoc_reply_flags_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_server_api_t.html">mongoc_server_api_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_server_api_version_t.html">mongoc_server_api_version_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_server_description_t.html">mongoc_server_description_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_session_opt_t.html">mongoc_session_opt_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_socket_t.html">mongoc_socket_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_ssl_opt_t.html">mongoc_ssl_opt_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_stream_buffered_t.html">mongoc_stream_buffered_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_stream_file_t.html">mongoc_stream_file_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_stream_socket_t.html">mongoc_stream_socket_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_stream_t.html">mongoc_stream_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_stream_tls_t.html">mongoc_stream_tls_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_topology_description_t.html">mongoc_topology_description_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_transaction_opt_t.html">mongoc_transaction_opt_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_transaction_state_t.html">mongoc_transaction_state_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_update_flags_t.html">mongoc_update_flags_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_uri_t.html">mongoc_uri_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_version.html">Version Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_write_concern_t.html">mongoc_write_concern_t</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="application-performance-monitoring.html">Application Performance Monitoring (APM)</a></li>
</ul>
<!-- Because full_index.rst includes everything that index.rst includes, we have to exclude index.rst from the table-of-contents. This page is simply a link forced into the sidebar (in conf.py) to avoid including full_index.rst in the ToC. -->
<ul><li class='toctree-l1'><a href="full_index.html">Index</a></li></ul>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    &copy; Copyright 2017-present, MongoDB, Inc.
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.1.2.
  </div>
  
  </body>
</html>