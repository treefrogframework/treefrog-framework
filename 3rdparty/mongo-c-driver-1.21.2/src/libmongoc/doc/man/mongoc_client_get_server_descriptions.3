.\" Man page generated from reStructuredText.
.
.TH "MONGOC_CLIENT_GET_SERVER_DESCRIPTIONS" "3" "Jun 07, 2022" "1.21.2" "libmongoc"
.SH NAME
mongoc_client_get_server_descriptions \- mongoc_client_get_server_descriptions()
.
.nr rst2man-indent-level 0
.
.de1 rstReportMargin
\\$1 \\n[an-margin]
level \\n[rst2man-indent-level]
level margin: \\n[rst2man-indent\\n[rst2man-indent-level]]
-
\\n[rst2man-indent0]
\\n[rst2man-indent1]
\\n[rst2man-indent2]
..
.de1 INDENT
.\" .rstReportMargin pre:
. RS \\$1
. nr rst2man-indent\\n[rst2man-indent-level] \\n[an-margin]
. nr rst2man-indent-level +1
.\" .rstReportMargin post:
..
.de UNINDENT
. RE
.\" indent \\n[an-margin]
.\" old: \\n[rst2man-indent\\n[rst2man-indent-level]]
.nr rst2man-indent-level -1
.\" new: \\n[rst2man-indent\\n[rst2man-indent-level]]
.in \\n[rst2man-indent\\n[rst2man-indent-level]]u
..
.SH SYNOPSIS
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
mongoc_server_description_t **
mongoc_client_get_server_descriptions (const mongoc_client_t *client,
                                       size_t *n) BSON_GNUC_WARN_UNUSED_RESULT;
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Fetches an array of \fBmongoc_server_description_t\fP structs for all known servers in the topology. Returns no servers until the client connects. Returns a single server if the client is directly connected, or all members of a replica set if the client\(aqs MongoDB URI includes a "replicaSet" option, or all known mongos servers if the MongoDB URI includes a list of them.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
void
show_servers (const mongoc_client_t *client)
{
   bson_t *b = BCON_NEW ("ping", BCON_INT32 (1));
   bson_error_t error;
   bool r;
   mongoc_server_description_t **sds;
   size_t i, n;

   /* ensure client has connected */
   r = mongoc_client_command_simple (client, "db", b, NULL, NULL, &error);
   if (!r) {
      MONGOC_ERROR ("could not connect: %s\en", error.message);
      return;
   }

   sds = mongoc_client_get_server_descriptions (client, &n);

   for (i = 0; i < n; ++i) {
      printf ("%s\en", mongoc_server_description_host (sds[i])\->host_and_port);
   }

   mongoc_server_descriptions_destroy_all (sds, n);
   bson_destroy (&b);
}
.ft P
.fi
.UNINDENT
.UNINDENT
.SH PARAMETERS
.INDENT 0.0
.IP \(bu 2
\fBclient\fP: A \fBmongoc_client_t\fP\&.
.IP \(bu 2
\fBn\fP: Receives the length of the descriptions array.
.UNINDENT
.SH RETURNS
.sp
A newly allocated array that must be freed with \fBmongoc_server_descriptions_destroy_all\fP\&.
.SH AUTHOR
MongoDB, Inc
.SH COPYRIGHT
2017-present, MongoDB, Inc
.\" Generated by docutils manpage writer.
.
